{"version":3,"sources":["../../server/node-web-streams-helper.ts"],"names":["encodeText","decodeText","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createHeadInjectionTransformStream","createDeferredSuffixStream","createInlineDataStream","createSuffixStream","createRootLayoutValidatorStream","continueFromInitialStream","input","TextEncoder","encode","textDecoder","decode","stream","TextDecoder","readable","transformStream","TransformStream","transformStream2","writer","writable","getWriter","writer2","reader","getReader","read","then","done","value","close","write","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","bufferedString","transform","v","pendingFlush","flushBuffer","controller","setTimeout","buffered","enqueue","chunk","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","renderToReadableStream","inject","injected","content","index","indexOf","injectedContent","slice","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}